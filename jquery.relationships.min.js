/* http://keith-wood.name/relationships.html
   Relationships for jQuery v1.2.0.
   Written by Keith Wood (kbwood@virginbroadband.com.au) January 2008.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){function Relationships(){this._defaults={opacity:20}}var l='relationships';$.extend(Relationships.prototype,{markerClassName:'hasRelationships',setDefaults:function(a){extendRemove(this._defaults,a||{})},_attachRelationships:function(a,b){a=$(a);if(a.is('.'+this.markerClassName)){return}a.addClass(this.markerClassName);if(!a[0].id){a[0].id='rl'+new Date().getTime()}var c={};c.options=$.extend({},b);$.data(a[0],l,c);this._updateRelationships(a,c)},_updateRelationships:function(a,b){a.html(this._generateHTML(a[0].id,b))},_changeRelationships:function(a,b){var c=$.data(a,l);if(c){extendRemove(c.options,b||{});$.data(a,l,c);this._updateRelationships($(a),c)}},_destroyRelationships:function(a){a=$(a);if(!a.is('.'+this.markerClassName)){return}a.removeClass(this.markerClassName).empty();$.removeData(a[0],l)},_showLinks:function(a,b,c){var d=$(a);var e=$.data(d[0],l);if(e){this._showLinks(d,e,b,c)}},_get:function(a,b){return(a.options[b]!=null?a.options[b]:$.relationships._defaults[b])},_generateHTML:function(a,b){var c=this._get(b,'set1');var d=this._get(b,'set2');var e=this._get(b,'description');var f='<div class="relationships_set1" style="height: '+c.imageSize[1]+'px;">'+this._addSet(a,c,1)+'</div>'+'<div class="relationships_set2" style="height: '+d.imageSize[1]+'px;">'+this._addSet(a,d,2)+'</div>'+'<div class="relationships_description">'+e+'</div>';return f},_addSet:function(a,b,c){var d='';for(var i=0;i<b.items.length;i++){var e=b.items[i];d+='<span class="relationships_item" id="'+i+'" '+'style="width: '+b.imageSize[0]+'px; '+'height: '+b.imageSize[1]+'px; '+($.browser.mozilla&&$.browser.version.substr(0,3)!='1.9'?' padding-left: '+b.imageSize[0]+'px; padding-bottom: '+(b.imageSize[1]-18)+'px;':'')+'background: transparent url(\''+b.images+'\') '+'no-repeat -'+((e.imageIndex||i)*b.imageSize[0])+'px 0px;" '+'onmouseover="jQuery.relationships._showLinks(\'#'+a+'\','+c+','+i+')" '+'onmouseout="jQuery.relationships._showLinks(\'#'+a+'\')"></span>'}return d},_showLinks:function(a,b,c){var d=$(a);var e=$.data(d[0],l);var f=this._get(e,'description');if(b){var g=this._get(e,'set'+b);f=g.items[c].description||g.items[c];var h=[[],[]];h[b-1]=[c];var j=this._get(e,'links')||[];for(var i=0;i<j.length;i++){if(j[i][b-1]==c){h[2-b][h[2-b].length]=j[i][2-b]}}var k=(this._get(e,'opacity')||20)/100;d.children('.relationships_set1').children().each(function(){$(this).css('opacity',($.inArray(parseInt(this.id),h[0])>-1?'1.0':k))});d.children('.relationships_set2').children().each(function(){$(this).css('opacity',($.inArray(parseInt(this.id),h[1])>-1?'1.0':k))})}else{d.find('span').each(function(){$(this).css('opacity','1.0')})}d.children('.relationships_description').text(f)}});function extendRemove(a,b){$.extend(a,b);for(var c in b){if(b[c]==null){a[c]=null}}return a}$.fn.relationships=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof a=='string'){$.relationships['_'+a+'Relationships'].apply($.relationships,[this].concat(b))}else{$.relationships._attachRelationships(this,a)}})};$(document).ready(function(){$.relationships=new Relationships()})})(jQuery);
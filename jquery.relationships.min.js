/* http://keith-wood.name/relationships.html
   Relationships for jQuery v1.1.0.
   Written by Keith Wood (kbwood@virginbroadband.com.au) January 2008.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){function Relationships(){this._nextId=0;this._inst=[];this._defaults={opacity:20}}$.extend(Relationships.prototype,{markerClassName:'hasRelationships',_register:function(a){var b=this._nextId++;this._inst[b]=a;return b},_getInst:function(a){return this._inst[a]||a},setDefaults:function(a){extendRemove(this._defaults,a||{})},_attachRelationships:function(a,b){a=$(a);if(a.is('.'+this.markerClassName)){return}a.addClass(this.markerClassName);a[0]._relId=b._id;b._target=a;this._updateRelationships(b._id)},_updateRelationships:function(a){var b=this._getInst(a);b._target.html(b._generateHTML())},_changeRelationships:function(a,b){var c=this._getInst(a._relId);if(c){extendRemove(c._settings,b||{});this._updateRelationships(c._id)}},_destroyRelationships:function(a){a=$(a);if(!a.is('.'+this.markerClassName)){return}a.removeClass(this.markerClassName);a.empty();this._inst[a[0]._cdnId]=null;a[0]._relId=undefined},_showLinks:function(a,b,c){var d=this._getInst(a);if(d){d._showLinks(b,c)}}});function RelationshipsInstance(a){this._id=$.relationships._register(this);this._target=null;this._settings=extendRemove({},a||{})}$.extend(RelationshipsInstance.prototype,{_get:function(a){return(this._settings[a]!=null?this._settings[a]:$.relationships._defaults[a])},_generateHTML:function(){var a=this._get('set1');var b=this._get('set2');var c=this._get('description');var d='<div class="relationships_set1" style="height: '+a.imageSize[1]+'px;">'+this._addSet(a,1)+'</div>'+'<div class="relationships_set2" style="height: '+b.imageSize[1]+'px;">'+this._addSet(b,2)+'</div>'+'<div class="relationships_description">'+c+'</div>';return d},_addSet:function(a,b){var c='';for(var i=0;i<a.items.length;i++){var d=a.items[i];c+='<span class="relationships_item" id="'+i+'" '+'style="width: '+a.imageSize[0]+'px; '+'height: '+a.imageSize[1]+'px; '+($.browser.mozilla?' padding-left: '+a.imageSize[0]+'px; padding-bottom: '+(a.imageSize[1]-18)+'px;':'')+'background: transparent url(\''+a.images+'\') '+'no-repeat -'+((d.imageIndex||i)*a.imageSize[0])+'px 0px;" '+'onmouseover="jQuery.relationships._showLinks('+this._id+','+b+','+i+')" '+'onmouseout="jQuery.relationships._showLinks('+this._id+')"></span>'}return c},_showLinks:function(a,b){var c=this._get('description');if(a){var d=this._get('set'+a);c=d.items[b].description||d.items[b];var e=[[],[]];e[a-1]=[b];var f=this._get('links')||[];for(var i=0;i<f.length;i++){if(f[i][a-1]==b){e[2-a][e[2-a].length]=f[i][2-a]}}var g=(this._get('opacity')||20)/100;this._target.children('.relationships_set1').children().each(function(){$(this).css('opacity',($.inArray(this.id,e[0])>-1?'1.0':g))});this._target.children('.relationships_set2').children().each(function(){$(this).css('opacity',($.inArray(this.id,e[1])>-1?'1.0':g))})}else{this._target.children().children().each(function(){$(this).css('opacity','1.0')})}this._target.children('.relationships_description').text(c)}});function extendRemove(a,b){$.extend(a,b);for(var c in b){if(b[c]==null){a[c]=null}}return a}$.fn.relationships=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof a=='string'){$.relationships['_'+a+'Relationships'].apply($.relationships,[this].concat(b))}else{$.relationships._attachRelationships(this,new RelationshipsInstance(a))}})};$(document).ready(function(){$.relationships=new Relationships()})})(jQuery);
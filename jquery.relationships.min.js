/* http://keith-wood.name/relationships.html
   Relationships for jQuery v1.3.0.
   Written by Keith Wood (kwood{at}iinet.com.au) January 2008.
   Available under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license. 
   Please attribute the author if you use it. */
(function($){function Relationships(){this._defaults={opacity:20,set1:{},set2:{},links:[],description:''}}$.extend(Relationships.prototype,{markerClassName:'hasRelationships',propertyName:'relationships',setDefaults:function(a){$.extend(this._defaults,a||{});return this},_attachPlugin:function(a,b){a=$(a);if(a.hasClass(this.markerClassName)){return}var c={options:$.extend({},this._defaults)};a.addClass(this.markerClassName).data(this.propertyName,c);this._optionPlugin(a,b)},_optionPlugin:function(a,b,c){a=$(a);var d=a.data(this.propertyName);if(!b||(typeof b=='string'&&c==null)){var e=b;b=(d||{}).options;return(b&&e?b[e]:b)}if(!a.hasClass(this.markerClassName)){return}b=b||{};if(typeof b=='string'){var e=b;b={};b[e]=c}$.extend(d.options,b);a.html(this._generateHTML(d))},_destroyPlugin:function(a){a=$(a);if(!a.hasClass(this.markerClassName)){return}a.removeClass(this.markerClassName).removeData(this.propertyName).empty()},_generateHTML:function(a){return this._addSet(a,1).add(this._addSet(a,2)).add('<div class="'+this.propertyName+'_description">'+a.options.description+'</div>')},_addSet:function(a,b){var c=a.options['set'+b];var d='<div class="'+this.propertyName+'_set'+b+'" style="height: '+c.imageSize[1]+'px;">';for(var i=0;i<c.items.length;i++){d+='<span class="'+this.propertyName+'_item" style="width: '+c.imageSize[0]+'px; '+'height: '+c.imageSize[1]+'px; '+'background: transparent url(\''+c.images+'\') '+'no-repeat -'+((c.items[i].imageIndex||i)*c.imageSize[0])+'px 0px;"></span>'}d=$(d+'</div>');d.find('.'+this.propertyName+'_item').hover(function(){n._showLinks(this,b)},function(){n._showLinks(this,0)});return d},_showLinks:function(b,c){b=$(b);var d=b.index();var e=b.closest('.'+n.markerClassName);var f=e.data(n.propertyName);var g=f.options.description;if(c){var h=f.options['set'+c];g=h.items[d].description||h.items[d];var j=[[],[]];j[c-1]=[d];var k=f.options.links||[];for(var i=0;i<k.length;i++){if(k[i][c-1]==d){j[2-c][j[2-c].length]=k[i][2-c]}}var l=(f.options.opacity||20)/100;e.find('.'+n.propertyName+'_set1 span').css('opacity',function(i,a){return($.inArray(i,j[0])>-1?'1.0':l)});e.find('.'+n.propertyName+'_set2 span').css('opacity',function(i,a){return($.inArray(i,j[1])>-1?'1.0':l)})}else{e.find('span').css('opacity','1.0')}e.find('.'+n.propertyName+'_description').text(g)}});var m=[''];function isNotChained(a,b){if(a=='option'&&(b.length==0||(b.length==1&&typeof b[0]=='string'))){return true}return $.inArray(a,m)>-1}$.fn.relationships=function(a){var b=Array.prototype.slice.call(arguments,1);if(isNotChained(a,b)){return n['_'+a+'Plugin'].apply(n,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){if(!n['_'+a+'Plugin']){throw'Unknown command: '+a;}n['_'+a+'Plugin'].apply(n,[this].concat(b))}else{n._attachPlugin(this,a||{})}})};var n=$.relationships=new Relationships()})(jQuery);